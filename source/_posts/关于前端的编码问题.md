---
title: å…³äºå‰ç«¯çš„ç¼–ç é—®é¢˜
date: 2022-10-02 09:52:44
tags: å‰ç«¯
---

**Unicodeã€JavaScriptå­—ç¬¦ä¸²ç¼–ç ã€emojiå±•ç¤º**

<!--more-->

## å‰ç«¯ç¼–ç åŸºç¡€

Unicodeå­—ç¬¦é›†ï¼šèŒƒå›´ä¸ºU+0000 \~ U+10FFFFï¼Œä¹Ÿç§°ä¸‡å›½ç ã€‚

å¯¹åº”çš„å­˜å‚¨æ–¹å¼ï¼šUTF-8ã€UTF-16ç­‰ã€‚

JavaScriptçš„å­—ç¬¦ä¸²ç¼–ç æ˜¯åŸºäºUTF-16çš„ï¼Œä¸€ä¸ªå­—ç¬¦å ä¸¤ä¸ªå­—èŠ‚ï¼›å› æ­¤ï¼Œå½“é¢å¯¹Unicodeç¼–ç >0xFFFFçš„å­—ç¬¦ï¼ŒJsä¼šè¯†åˆ«ä¸ºä¸¤ä¸ªå­—ï¼Œå³4ä¸ªå­—èŠ‚ã€‚

â€‹	ä¾‹å¦‚ï¼š`â€œğ¢‚˜ğ¢‚˜â€.length ==> 4`ï¼ŒåŸå› æ˜¯`ğ¢‚˜`çš„Unicodeç¼–ç ä¸º0x22098ï¼Œ>0xFFFFã€‚

â€‹	éœ€è¦ç‰¹æ®Šæ³¨æ„çš„æ˜¯ï¼šHTMLä¸­Inputæ ‡ç­¾çš„maxlengthå±æ€§ä¸JavaScriptä¿æŒä¸€è‡´ï¼ŒmaxLengthé™åˆ¶ä¸º4çš„è¯ï¼Œè¾“å…¥`ğ¢‚˜ğ¢‚˜`åå°±ä¸å…è®¸å†è¾“å…¥å­—ç¬¦äº†ã€‚

## UTF-16çš„ç›¸å…³è¿ç®—

Unicodeå­—ç¬¦é›†å­˜åœ¨ä¸€ä¸ªä»£ç†åŒºçš„æ¦‚å¿µï¼Œè¿™æ®µåŒºåŸŸæ˜¯0xD800`-`0xDFFFï¼Œä¿ç•™è¿™æ®µåŒºåŸŸæ˜¯ä¸ºäº†è®©UTF-16ç­‰å­˜å‚¨ç¼–ç æ–¹å¼ä½¿ç”¨ã€‚

> UTF16ç¼–ç è§„åˆ™ï¼š
>
> 1. ç ä½å‡å» `0x10000`ï¼Œå¾—åˆ°çš„å€¼çš„èŒƒå›´ä¸º20æ¯”ç‰¹é•¿çš„ `0...0xFFFFF`ï¼Œä¸è¶³çš„è¯ï¼Œå‰é¢è¡¥0å–½ã€‚
> 2. é«˜ä½çš„10æ¯”ç‰¹çš„å€¼åŠ ä¸Š `0xD800` å¾—åˆ°ç¬¬ä¸€ä¸ªç å…ƒ
> 3. ä½ä½çš„10æ¯”ç‰¹çš„å€¼åŠ ä¸Š `0xDC00` å¾—åˆ°ç¬¬äºŒä¸ªç å…ƒ

> è¿™é‡Œå¼•å…¥ä¸€ä¸‹'ğ¢‚˜'è¿™ä¸ªå­—ç¬¦ä»Unicodeç¼–ç è½¬ä¸ºä¸ºUTF-16å­˜å‚¨ç¼–ç çš„è¿‡ç¨‹ï¼Œ0x22098-0x10000 = 0x12098 => 0001 00100000 10011000
>
> é«˜10ä½+0xD800 =  0001 001000 + 0xD800 = 0x48 + 0xD800 = 0xD848
>
> ä½10ä½+0xDC00 =  00 10011000 + 0xDC00 = 0x98 + 0xDC00 = 0cDC98
>
> å› æ­¤'ğ¢‚˜'è¿™ä¸ªå­—ç¬¦å®é™…åœ¨JavaScriptçš„å­˜å‚¨å½¢å¼ä¸ºï¼š\uD848,\uDC98ã€‚

## JavaScriptçš„å­—ç¬¦ä¸²éå†ä¸è¿ç®—

ç”±äºå­˜åœ¨ä¸€ä¸ªå­—ç¬¦å ä¸¤ä¸ªå­—çš„æƒ…å†µï¼ˆUnicodeç¼–ç >0xFFFFï¼‰ï¼Œå› æ­¤ä¼ ç»Ÿçš„foréå†ä¸‹æ ‡è‡ªç„¶ä¸èƒ½æ­£ç¡®æ‹¿åˆ°æ¯ä¸ªå­—ã€‚

ES6ä¹‹åæœ‰äº†è¿­ä»£å™¨ï¼Œä¾æ®è¿­ä»£å™¨å¯ä»¥è§£å†³æ­¤ç±»é—®é¢˜ï¼Œæ¯”å¦‚for oféå†ã€`...`æ‹“å±•è¿ç®—ç¬¦ã€‚

å¦‚ä½•çœ‹åˆ°å­—ç¬¦ä¸²çš„ç¼–ç ç»†èŠ‚å‘¢ï¼Ÿ

> **String.prototype.codePointAt(pos)**ï¼šå¯¹è°ƒç”¨å­—ç¬¦ä¸²çš„posä½ç½®è¿›è¡Œè§£ç ï¼Œè¿”å›çš„æ˜¯åè¿›åˆ¶ï¼›posè½ä½äºUTF-16é«˜ä½ï¼Œè§£ææ•´ä¸ªç¬¦å·ï¼Œposè½ä½äºUTF-16ä½ä½ï¼Œåªè§£æä½ä½çš„å­—ã€‚

å¦‚æœæ˜¯å¸Œæœ›çœ‹åˆ°æ¯ä¸ªå­—çš„Unicodeç¼–ç ï¼Œfor of + codePointAtå³å¯ã€‚

è€Œé¢å¯¹Unicodeç¼–ç >0xFFFFçš„å­—ç¬¦ï¼Œå¯ä»¥é€šè¿‡ES8çš„Object.values()æŸ¥çœ‹å…¶è½¬æ¢åçš„UTF-16ç¼–ç ï¼Œæ¯”å¦‚ `Object.values("ğ¢‚˜")==>['\uD848', '\uDC98']`ã€‚

## Emojiè¡¨æƒ…ç›¸å…³æ‹“å±•

å¤§å¤šæ•°Emojiçš„Unicodeç¼–ç éƒ½å¤§äº0xFFFFï¼Œå ä¸¤ä¸ªå­—ï¼Œlength==2ï¼›ä¸è¿‡ä¹Ÿæœ‰åªå ä¸€ä¸ªå­—çš„ï¼Œæ¯”å¦‚é›ªäºº`\u{26C4}`ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯è¿˜å­˜åœ¨ç»„åˆemojiçš„æƒ…å†µï¼Œæ¯”å¦‚è‚¤è‰²ç›¸å…³çš„emojiã€æ——å¸œåºåˆ—emojiç­‰ç­‰ã€‚

[Emojiè¡¨æƒ…å¤§å…¨](https://www.unicode.org/emoji/charts/emoji-list.html#0030_20e3)

æ€ä¹ˆæ„å»ºä¸€ä¸ªåŒ…å«Emojiçš„å­—ç¬¦ä¸²å‘¢ï¼Ÿ

> **String.fromCharCode(num1,...)**ï¼šæ¥å—ä¸€ç³»åˆ—16è¿›åˆ¶æ•°ï¼Œä¾æ®UTF-16è¿”å›ç”Ÿæˆçš„å­—ç¬¦ä¸²ã€‚ï¼ˆUTF-16ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæ˜¾ç¤º''ğ¢‚˜''éœ€è¦ä¼ 0xD848,0xDC98ï¼‰

- ç”¨`\u+UTF-16ç¼–ç `çš„æ–¹å¼ï¼Œæ¯”å¦‚`\u26C4`ã€‚
- ç”¨`\u{Unicodeç¼–ç }`çš„æ–¹å¼ï¼Œæ¯”å¦‚`\u{1F970}`ã€‚
- ç”¨`String.fromCharCode(UTF-16ç¼–ç )`æ–¹æ³•ï¼Œæ¯”å¦‚`String.fromCharCode(0x26c4)`ã€‚

æ€ä¹ˆåœ¨ç½‘é¡µä¸Šå±•ç¤ºEmojiå‘¢ï¼Ÿ

- åè¿›åˆ¶ï¼š`&#129409;`
- åå…­è¿›åˆ¶ï¼š`&#x1F981;`

### å¦‚ä½•å¤„ç†å¯èƒ½åŒ…å«emojiçš„å­—ç¬¦ä¸²å‘¢

å¯¹äºå•ä¸ªemojiå­—ç¬¦ï¼Œç”±äºè¿­ä»£å™¨çš„å‡ºç°ï¼Œå…¶å®Array.fromèƒ½å¤„ç†è¿™äº›caseã€‚
æ¯”å¦‚Array.from("ğŸ˜€ğŸ˜ƒğŸ˜„ğŸ˜")==>['ğŸ˜€','ğŸ˜ƒ','ğŸ˜„','ğŸ˜']

ä½†Emojiå­˜åœ¨å­—ç¬¦ç°‡çš„æ¦‚å¿µï¼Œå³å¯ä»¥é€šè¿‡ç»„åˆå¤šä¸ªemojiå½¢æˆä¸€ä¸ªæ–°çš„emojiï¼Œæ¯”å¦‚ï¼š"ğŸ‡¨ğŸ‡³".length = 4
è¿™ä¸ªæ—¶å€™å¦‚æœArray.from("ğŸ‡¨ğŸ‡³") ==> ['ğŸ‡¨','ğŸ‡³'],å¹¶ä¸èƒ½è¾¾åˆ°é¢„æœŸæ•ˆæœã€‚
æ‰€ä»¥éœ€è¦å€ŸåŠ©å¤–éƒ¨åŠ›é‡äº†ï¼Œlodash.toArrayå°±èƒ½å®Œæˆè¿™ä¸ªå¤„ç†

å½“ç„¶åœ¨æç«¯æƒ…å†µä¸‹ï¼Œä½ ä¹Ÿå¯ä»¥è€ƒè™‘ç›´æ¥æŠŠæ‰€æœ‰emojiéƒ½å¹²æ‰ï¼ˆæ¯”å¦‚IOS16.5ä¸­ï¼Œtext overflowé‡åˆ°emojiæˆªæ–­å¯èƒ½å¯¼è‡´é¡µé¢å¡æ­»ï¼‰
```javascript
/**
 * ç§»é™¤æ–‡æ¡ˆä¸­çš„emoji
 * @param content å¾…å¤„ç†æ–‡æ¡ˆ
 * @returns
 */
export const removeEmoji = (content:string) => {
  return content.replace(/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g, '');
};
```